---
import { projects } from "../data/ProjectsMapData"
---
<!-- The <Layout> wrapper is REMOVED. This is now just a self-contained section. -->
<section id="location" class="bg-gray-50">
  <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
    <!-- Section Header --> 
    <div class="text-center mb-12">
      <div class="text-center">
      <h2 class="text-3xl font-bold tracking-tight text-gray-900 sm:text-4xl" style="font-family: 'Poppins'">
        Our Pan-India Project Footprint
      </h2>
      <div class="w-24 h-1 mx-auto mt-4 bg-yellow-500 rounded"></div>
      </div>
      <p class="mt-4 max-w-2xl mx-auto text-xl text-gray-600">
        Explore our diverse portfolio of food processing projects across the nation. Click on a project to locate it on the map.
      </p>
    </div>

    <!-- Main Layout: Map and List -->
    <div class="flex flex-col md:flex-row gap-8 bg-white shadow-inner rounded-lg overflow-hidden">
      
      <!-- Left Side: Map Container -->
      <div id="map" class="w-full md:w-1/2 h-[500px] md:h-auto z-0"></div>

      <!-- Right Side: Scrollable Project List -->
      <div class="w-full md:w-1/2 p-4">
        
        <div class="overflow-y-auto h-[500px] md:h-[600px] pr-2">
          <div class="space-y-4">
            {projects.map(project => (
              <div 
                class="project-item p-4 border rounded-md cursor-pointer hover:bg-green-50 hover:shadow-md transition-all duration-200"
                data-project-id={project.id}
              >
                <p class="font-bold text-lg text-green-700">{project.name}</p>
                <p class="text-sm text-gray-600 mt-1">{project.location}</p>
                <div class="flex justify-between items-center mt-2 text-sm">
                  <span class="font-semibold text-gray-800">Cost: {project.cost}</span>
                  <span class="text-xs font-medium bg-blue-100 text-blue-800 px-2 py-1 rounded-full">{project.type}</span>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- The script remains exactly the same. It is now scoped to this component. -->
<script define:vars={{ projects }}>
  // A check to prevent re-initialization if the component is used multiple times on a page
  // Although in this case the ID would cause issues first. A better approach for multi-use
  // would be to generate unique IDs, but for a single homepage use, this is fine.
  if (!document.getElementById('map')._leaflet_id) {
    document.addEventListener('DOMContentLoaded', () => {
        // 1. Initialize the Map
        const map = L.map('map').setView([22.5, 82.0], 5);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // 2. Add Markers to the Map
        const markers = {};
        projects.forEach(project => {
            const marker = L.marker(project.coords)
              .addTo(map)
              .bindPopup(`<b>${project.name}</b><br>${project.location}<br>Cost: ${project.cost}`);
            markers[project.id] = marker;
        });

        // 3. Handle Clicks on the Project List
        const projectItems = document.querySelectorAll('.project-item');
        projectItems.forEach(item => {
            item.addEventListener('click', () => {
                const projectId = item.dataset.projectId;
                const project = projects.find(p => p.id === projectId);
                const marker = markers[projectId];

                if (project && marker) {
                    map.flyTo(project.coords, 9, { animate: true, duration: 1.5 });
                    marker.openPopup();
                }
            });
        });
    });
  }
</script>